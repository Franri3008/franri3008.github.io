<div id="sliderPanel" class="range-slider-panel">
  <div class="range-slider-head">
    <span data-role="title-start" class="range-slider-title">Starting Week</span>
    <span data-role="title-end" class="range-slider-title">Ending Week</span>
  </div>
  <div class="range-slider-values">
    <span data-label="start" class="range-slider-value">Week 0</span>
    <span data-label="end" class="range-slider-value">Week 0</span>
  </div>
  <div class="range-slider-control">
    <div class="range-slider-track">
      <div class="range-slider-selection" data-role="selection"></div>
    </div>
    <input type="range" min="0" max="0" step="1" value="0" data-role="start" aria-label="Starting period">
    <input type="range" min="0" max="0" step="1" value="0" data-role="end" aria-label="Ending period">
  </div>
</div>
<style>
.range-slider-panel {
  width: 100%;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  gap: 2px;
  padding: 4px 24px;
  background: rgba(255, 255, 255, 0.7);
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.18);
  font-size: clamp(8px, 1.5vw, 12px);
}

.range-slider-panel.is-disabled {
  opacity: 0.6;
}

.range-slider-head,
.range-slider-values {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}

.range-slider-title {
  font-weight: 600;
  color: #333;
}

.range-slider-value {
  font-weight: 600;
  color: #a9a9a9;
}

.range-slider-control {
  position: relative;
  height: 24px;
}

.range-slider-track {
  position: absolute;
  left: 0;
  right: 0;
  top: 75%;
  height: clamp(2px, 1.5vw, 6px);
  background: #e2e5f1;
  border-radius: 999px;
  transform: translateY(-50%);
  pointer-events: none;
}

.range-slider-selection {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 100%;
  background: #2756d3;
  border-radius: 999px;
}

.range-slider-control input[type="range"] {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  width: 100%;
  margin: 0;
  background: none;
  pointer-events: none;
  appearance: none;
  -webkit-appearance: none;
}

.range-slider-control input[data-role="start"] {
  z-index: 2;
}

.range-slider-control input[data-role="end"] {
  z-index: 3;
}

.range-slider-control input[type="range"]::-webkit-slider-runnable-track {
  height: 6px;
  background: transparent;
}

.range-slider-control input[type="range"]::-webkit-slider-thumb {
  pointer-events: all;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid #2756d3;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
  -webkit-appearance: none;
  appearance: none;
}

.range-slider-control input[type="range"]::-moz-range-track {
  height: 6px;
  background: transparent;
}

.range-slider-control input[type="range"]::-moz-range-thumb {
  pointer-events: all;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #ffffff;
  border: 2px solid #2756d3;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
}

.range-slider-control input[type="range"]:disabled::-webkit-slider-thumb,
.range-slider-control input[type="range"]:disabled::-moz-range-thumb {
  border-color: #aeb4c4;
  background: #f0f1f5;
}
</style>
<script>
(function(){
  const clamp=(value,min,max)=>Math.min(Math.max(value,min),max);
  const RangeSlider={
    init(config){
      if(!config||!config.containerEl){ return; }
      this.root=config.containerEl.querySelector(".range-slider-panel")||config.containerEl;
      this.startInput=this.root.querySelector('[data-role="start"]');
      this.endInput=this.root.querySelector('[data-role="end"]');
      this.selectionEl=this.root.querySelector('[data-role="selection"]');
      this.startTitle=this.root.querySelector('[data-role="title-start"]');
      this.endTitle=this.root.querySelector('[data-role="title-end"]');
      this.startValue=this.root.querySelector('[data-label="start"]');
      this.endValue=this.root.querySelector('[data-label="end"]');
      this.onChange=typeof config.onChange==="function"?config.onChange:function(){};
      this.getLabel=function(index){ return String(index); };
      this.unitLabel="Period";
      this.state={min:0,max:0,start:0,end:0};
      const handleInput=role=>{
        if(!this.startInput||!this.endInput){ return; }
        const input=role==="start"?this.startInput:this.endInput;
        let value=Math.round(Number(input.value));
        if(!Number.isFinite(value)){
          value=role==="start"?this.state.start:this.state.end;
        }
        value=clamp(value,this.state.min,this.state.max);
        if(role==="start"){
          this.state.start=value;
          if(value>this.state.end){
            this.state.end=value;
            this.endInput.value=String(value);
          }
        }else{
          this.state.end=value;
          if(value<this.state.start){
            this.state.start=value;
            this.startInput.value=String(value);
          }
        }
        this.updateDerived(true);
      };
      if(this.startInput){
        this.startInput.addEventListener("input",()=>handleInput("start"));
        this.startInput.addEventListener("change",()=>handleInput("start"));
      }
      if(this.endInput){
        this.endInput.addEventListener("input",()=>handleInput("end"));
        this.endInput.addEventListener("change",()=>handleInput("end"));
      }
      this.updateDerived(false);
    },
    update(config){
      if(!this.root){ return; }
      const cfg=config||{};
      const hasBounds=Number.isFinite(cfg.min)&&Number.isFinite(cfg.max)&&cfg.max>=cfg.min;
      const min=hasBounds?Math.round(cfg.min):0;
      const max=hasBounds?Math.round(cfg.max):0;
      const usable=hasBounds;
      const startCandidate=Number.isFinite(cfg.start)?Math.round(cfg.start):(usable?min:0);
      const endCandidate=Number.isFinite(cfg.end)?Math.round(cfg.end):(usable?max:0);
      this.state.min=usable?min:0;
      this.state.max=usable?max:0;
      this.state.start=usable?clamp(startCandidate,this.state.min,this.state.max):this.state.min;
      this.state.end=usable?clamp(endCandidate,this.state.start,this.state.max):this.state.start;
      if(this.startInput){
        this.startInput.min=String(this.state.min);
        this.startInput.max=String(this.state.max);
        this.startInput.value=String(this.state.start);
        this.startInput.disabled=!usable||this.state.max<=this.state.min;
      }
      if(this.endInput){
        this.endInput.min=String(this.state.min);
        this.endInput.max=String(this.state.max);
        this.endInput.value=String(this.state.end);
        this.endInput.disabled=!usable||this.state.max<=this.state.min;
      }
      if(typeof cfg.getLabel==="function"){
        this.getLabel=cfg.getLabel;
      }
      if(typeof cfg.unitLabel==="string"&&cfg.unitLabel.trim().length){
        this.unitLabel=cfg.unitLabel;
      }
      this.root.classList.toggle("is-disabled",!usable||this.state.max<=this.state.min);
      this.updateDerived(false);
    },
    updateDerived(emit){
      this.updateLabels();
      this.updateSelection();
      if(emit&&this.onChange){
        this.onChange({start:this.state.start,end:this.state.end});
      }
    },
    updateLabels(){
      if(this.startTitle){
        this.startTitle.textContent=`Starting ${this.unitLabel}`;
      }
      if(this.endTitle){
        this.endTitle.textContent=`Ending ${this.unitLabel}`;
      }
      if(this.startValue){
        this.startValue.textContent=this.getLabel(this.state.start);
      }
      if(this.endValue){
        this.endValue.textContent=this.getLabel(this.state.end);
      }
    },
    updateSelection(){
      if(!this.selectionEl){ return; }
      const span=this.state.max-this.state.min;
      if(!Number.isFinite(span)||span<=0){
        this.selectionEl.style.left="0%";
        this.selectionEl.style.right="100%";
        return;
      }
      const startRatio=(this.state.start-this.state.min)/span;
      const endRatio=(this.state.end-this.state.min)/span;
      this.selectionEl.style.left=`${startRatio*100}%`;
      this.selectionEl.style.right=`${100-endRatio*100}%`;
    }
  };
  window.RangeSlider=RangeSlider;
})();
</script>
