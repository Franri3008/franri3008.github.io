<!doctype html>
<html>

  <head>

    <meta charset="utf-8">
    <title>Forced Network</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

    <style>

      html, body {
        margin: 0;
        height: 100%;
        font-family: "Avenir Next", "Helvetica Neue", Arial, sans-serif;
        background: #f5f7fa;
      }

      svg.network {
        width: 100vw;
        height: 100vh;
        display: block;
        cursor: move;
        background: #ffffff;
      }

      .link {
        stroke: rgba(140, 150, 170, 0.45);
      }

      .link.highlighted {
        stroke: rgba(80, 90, 110, 0.9);
      }

      .link.dimmed {
        opacity: 0.2;
      }

      .node.dimmed {
        opacity: 0.25;
      }

      .node.highlighted circle {
        stroke: #131722;
        stroke-width: 3px;
      }

      .node.highlighted text {
        font-weight: 700;
      }

      .node circle {
        stroke: #ffffff;
        stroke-width: 2px;
      }

      .node text {
        fill: #1b1d21;
        font-size: 12px;
        font-weight: 600;
        text-anchor: middle;
        pointer-events: none;
      }

      .zoom-controls {
        position: absolute;
        top: 16px;
        left: 16px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        z-index: 10;
      }

      .zoom-controls button {
        width: 36px;
        height: 36px;
        font-size: 18px;
        line-height: 1;
        border: 1px solid #d0d4dc;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        color: #344563;
      }

      .zoom-controls button:active {
        transform: scale(0.96);
      }

    </style>

  </head>

  <body>

    <div class="zoom-controls">
      <button type="button" data-zoom="in">+</button>
      <button type="button" data-zoom="out">-</button>
      <button type="button" data-zoom="reset">R</button>
    </div>

    <svg class="network"></svg>

    <script>

      var nodes =  [{"id":"AI & Big Data","id2":0,"x":0.2541,"y":2.3447,"color":"#365a94","parent":"ICT","size":1.5},{"id":"Automation & robotics","id2":1,"x":0.8004,"y":1.5651,"color":"#365a94","parent":"ICT","size":1.5},{"id":"Autonomous & connected mobility","id2":27,"x":0.2423,"y":1.332,"color":"#6a0dad","parent":"Future Mobility","size":1.5},{"id":"Biophotonics","id2":2,"x":2.1005,"y":5.9086,"color":"#EEDC82","parent":"Life Sciences","size":1.5},{"id":"Bioprocess technology","id2":3,"x":1.7326,"y":4.3273,"color":"#800020","parent":"AgriFood Tech","size":1.5},{"id":"Biotechnologies","id2":4,"x":0.5363,"y":4.6686,"color":"#EEDC82","parent":"Life Sciences","size":1.5},{"id":"CCS / CCU","id2":5,"x":2.9429,"y":-0.3131,"color":"#8cab79","parent":"Climate Tech","size":1.5},{"id":"CO2-neutral production","id2":6,"x":-1.3134,"y":5.0327,"color":"#e28f26","parent":"Industrial Tech","size":1.5},{"id":"Cyber defense & infrastructure","id2":7,"x":-1.388,"y":1.7921,"color":"#8B4513","parent":"Defense Tech","size":1.5},{"id":"Cybersecurity","id2":22,"x":-1.6355,"y":2.16,"color":"#365a94","parent":"ICT","size":1.5},{"id":"Data ecosystems","id2":29,"x":-0.9562,"y":2.7014,"color":"#e28f26","parent":"Industrial Tech","size":1.5},{"id":"Data sciences & digital health","id2":8,"x":0.2356,"y":3.5733,"color":"#EEDC82","parent":"Life Sciences","size":1.5},{"id":"Geothermal energy","id2":12,"x":-0.3679,"y":5.9813,"color":"#8cab79","parent":"Climate Tech","size":1.5},{"id":"Immersive technologies","id2":9,"x":1.375,"y":1.9568,"color":"#365a94","parent":"ICT","size":1.5},{"id":"Individual mass production","id2":33,"x":1.5714,"y":1.0907,"color":"#e28f26","parent":"Industrial Tech","size":1.5},{"id":"Industrial robotics","id2":23,"x":0.7892,"y":0.7032,"color":"#e28f26","parent":"Industrial Tech","size":1.5},{"id":"Maritime technology","id2":37,"x":0.3155,"y":-0.0427,"color":"#8B4513","parent":"Defense Tech","size":1.5},{"id":"Medical technology","id2":10,"x":0.7256,"y":3.3697,"color":"#EEDC82","parent":"Life Sciences","size":1.5},{"id":"Mobility services","id2":11,"x":-1.3793,"y":3.3377,"color":"#6a0dad","parent":"Future Mobility","size":1.5},{"id":"More flexible energy systems","id2":30,"x":3.4418,"y":0.0921,"color":"#8cab79","parent":"Climate Tech","size":1.5},{"id":"Nanotechnologies","id2":13,"x":-0.3297,"y":4.3791,"color":"#669999","parent":"Deep Tech","size":1.5},{"id":"Neural interfaces","id2":14,"x":0.4879,"y":4.2043,"color":"#669999","parent":"Deep Tech","size":1.5},{"id":"Nuclear fusion","id2":15,"x":3.4678,"y":2.6154,"color":"#8cab79","parent":"Climate Tech","size":1.5},{"id":"Optics & photonics","id2":16,"x":2.743,"y":4.5469,"color":"#669999","parent":"Deep Tech","size":1.5},{"id":"Overall defense strategy","id2":17,"x":-1.1284,"y":0.9736,"color":"#8B4513","parent":"Defense Tech","size":1.5},{"id":"Personalized medicine","id2":18,"x":1.2558,"y":3.4696,"color":"#EEDC82","parent":"Life Sciences","size":1.5},{"id":"Personalized nutrition","id2":36,"x":2.6615,"y":2.0108,"color":"#800020","parent":"AgriFood Tech","size":1.5},{"id":"Platform economy","id2":19,"x":2.757,"y":3.3911,"color":"#800020","parent":"AgriFood Tech","size":1.5},{"id":"Precision breeding","id2":26,"x":1.471,"y":5.2298,"color":"#800020","parent":"AgriFood Tech","size":1.5},{"id":"Private air transport","id2":20,"x":-1.2397,"y":1.3215,"color":"#6a0dad","parent":"Future Mobility","size":1.5},{"id":"Quantum technologies","id2":21,"x":-1.5273,"y":3.0323,"color":"#669999","parent":"Deep Tech","size":1.5},{"id":"Semiconductors & microchips","id2":31,"x":0.6007,"y":2.9752,"color":"#669999","parent":"Deep Tech","size":1.5},{"id":"Smart factories","id2":24,"x":1.8073,"y":1.4337,"color":"#e28f26","parent":"Industrial Tech","size":1.5},{"id":"Smart farming","id2":32,"x":1.5903,"y":2.4239,"color":"#800020","parent":"AgriFood Tech","size":1.5},{"id":"Space logistics","id2":34,"x":-2.441,"y":1.5028,"color":"#6a0dad","parent":"Future Mobility","size":1.5},{"id":"UAS & drone defense","id2":28,"x":0.2522,"y":0.9666,"color":"#8B4513","parent":"Defense Tech","size":1.5},{"id":"Ubiquitous computing","id2":35,"x":1.7488,"y":2.8954,"color":"#365a94","parent":"ICT","size":1.5},{"id":"Water purification","id2":38,"x":4.3506,"y":3.999,"color":"#8cab79","parent":"Climate Tech","size":1.5},{"id":"Weapon systems & ammunition","id2":25,"x":-0.3438,"y":0.2992,"color":"#8B4513","parent":"Defense Tech","size":1.5}]  ;

      var links =   [{"source":"AI & Big Data","target":"Automation & robotics","weight":6.3},{"source":"AI & Big Data","target":"Cybersecurity","weight":3.51},{"source":"AI & Big Data","target":"Data sciences & digital health","weight":12.08},{"source":"AI & Big Data","target":"Semiconductors & microchips","weight":2.22},{"source":"Automation & robotics","target":"Autonomous & connected mobility","weight":5.5},{"source":"Automation & robotics","target":"Industrial robotics","weight":17.96},{"source":"Automation & robotics","target":"Maritime technology","weight":1.86},{"source":"Automation & robotics","target":"Smart factories","weight":8.84},{"source":"Automation & robotics","target":"UAS & drone defense","weight":5.09},{"source":"Biophotonics","target":"Optics & photonics","weight":9.87},{"source":"Bioprocess technology","target":"Biotechnologies","weight":13.74},{"source":"Biotechnologies","target":"Personalized medicine","weight":22.95},{"source":"CCS / CCU","target":"More flexible energy systems","weight":4.92},{"source":"CCS / CCU","target":"Smart factories","weight":0.59},{"source":"CO2-neutral production","target":"Mobility services","weight":0.46},{"source":"Cyber defense & infrastructure","target":"Cybersecurity","weight":19.04},{"source":"AI & Big Data","target":"Data ecosystems","weight":5.08},{"source":"Data sciences & digital health","target":"Personalized medicine","weight":15.92},{"source":"AI & Big Data","target":"Immersive technologies","weight":3.34},{"source":"Immersive technologies","target":"Individual mass production","weight":3.66},{"source":"Medical technology","target":"Personalized medicine","weight":18.93},{"source":"Mobility services","target":"Private air transport","weight":0.93},{"source":"Geothermal energy","target":"Nanotechnologies","weight":0.5},{"source":"Nanotechnologies","target":"Semiconductors & microchips","weight":2.48},{"source":"Neural interfaces","target":"Personalized medicine","weight":3.65},{"source":"Nuclear fusion","target":"Ubiquitous computing","weight":1.34},{"source":"Nuclear fusion","target":"Water purification","weight":1.84},{"source":"Optics & photonics","target":"Semiconductors & microchips","weight":4.49},{"source":"Overall defense strategy","target":"Space logistics","weight":3.26},{"source":"Overall defense strategy","target":"UAS & drone defense","weight":3.03},{"source":"Overall defense strategy","target":"Weapon systems & ammunition","weight":5.72},{"source":"Personalized medicine","target":"Personalized nutrition","weight":2.43},{"source":"Platform economy","target":"Smart farming","weight":1.33},{"source":"Bioprocess technology","target":"Precision breeding","weight":5.71},{"source":"Private air transport","target":"Space logistics","weight":2.94},{"source":"Quantum technologies","target":"Semiconductors & microchips","weight":2.34},{"source":"Automation & robotics","target":"Smart farming","weight":4.42},{"source":"Personalized medicine","target":"Ubiquitous computing","weight":2.54},{"source":"Personalized medicine","target":"Biotechnologies","weight":22.95},{"source":"Cybersecurity","target":"Cyber defense & infrastructure","weight":19.04},{"source":"Personalized medicine","target":"Medical technology","weight":18.93},{"source":"Industrial robotics","target":"Automation & robotics","weight":17.96},{"source":"Personalized medicine","target":"Data sciences & digital health","weight":15.92},{"source":"Biotechnologies","target":"Bioprocess technology","weight":13.74},{"source":"Data sciences & digital health","target":"AI & Big Data","weight":12.08},{"source":"Optics & photonics","target":"Biophotonics","weight":9.87},{"source":"Smart factories","target":"Automation & robotics","weight":8.84},{"source":"Medical technology","target":"Biotechnologies","weight":6.47},{"source":"Biotechnologies","target":"Medical technology","weight":6.47},{"source":"Automation & robotics","target":"AI & Big Data","weight":6.3},{"source":"Data sciences & digital health","target":"Biotechnologies","weight":6.05},{"source":"Biotechnologies","target":"Data sciences & digital health","weight":6.05},{"source":"Personalized medicine","target":"AI & Big Data","weight":6.03},{"source":"AI & Big Data","target":"Personalized medicine","weight":6.03},{"source":"Weapon systems & ammunition","target":"Overall defense strategy","weight":5.72},{"source":"Precision breeding","target":"Bioprocess technology","weight":5.71},{"source":"Autonomous & connected mobility","target":"Automation & robotics","weight":5.5},{"source":"UAS & drone defense","target":"Automation & robotics","weight":5.09},{"source":"Data ecosystems","target":"AI & Big Data","weight":5.08},{"source":"Smart factories","target":"Industrial robotics","weight":5.08},{"source":"Industrial robotics","target":"Smart factories","weight":5.08},{"source":"Medical technology","target":"Data sciences & digital health","weight":4.95},{"source":"Data sciences & digital health","target":"Medical technology","weight":4.95},{"source":"More flexible energy systems","target":"CCS / CCU","weight":4.92},{"source":"Semiconductors & microchips","target":"Optics & photonics","weight":4.49},{"source":"Smart farming","target":"Automation & robotics","weight":4.42},{"source":"Individual mass production","target":"Immersive technologies","weight":3.66},{"source":"Personalized medicine","target":"Neural interfaces","weight":3.65},{"source":"Smart factories","target":"AI & Big Data","weight":3.58},{"source":"AI & Big Data","target":"Smart factories","weight":3.58},{"source":"Cybersecurity","target":"AI & Big Data","weight":3.51},{"source":"Immersive technologies","target":"AI & Big Data","weight":3.34},{"source":"Smart farming","target":"AI & Big Data","weight":3.31},{"source":"AI & Big Data","target":"Smart farming","weight":3.31},{"source":"UAS & drone defense","target":"Autonomous & connected mobility","weight":3.26},{"source":"Space logistics","target":"Overall defense strategy","weight":3.26},{"source":"Autonomous & connected mobility","target":"UAS & drone defense","weight":3.26},{"source":"UAS & drone defense","target":"Overall defense strategy","weight":3.03},{"source":"Space logistics","target":"Private air transport","weight":2.94},{"source":"Data ecosystems","target":"Cybersecurity","weight":2.89},{"source":"Cybersecurity","target":"Data ecosystems","weight":2.89},{"source":"Weapon systems & ammunition","target":"UAS & drone defense","weight":2.88},{"source":"UAS & drone defense","target":"Weapon systems & ammunition","weight":2.88},{"source":"Neural interfaces","target":"Medical technology","weight":2.83},{"source":"Medical technology","target":"Neural interfaces","weight":2.83},{"source":"Autonomous & connected mobility","target":"AI & Big Data","weight":2.65},{"source":"AI & Big Data","target":"Autonomous & connected mobility","weight":2.65},{"source":"Overall defense strategy","target":"Cyber defense & infrastructure","weight":2.64},{"source":"Cyber defense & infrastructure","target":"Overall defense strategy","weight":2.64},{"source":"UAS & drone defense","target":"Private air transport","weight":2.6},{"source":"Private air transport","target":"UAS & drone defense","weight":2.6},{"source":"Ubiquitous computing","target":"Personalized medicine","weight":2.54},{"source":"Personalized medicine","target":"Bioprocess technology","weight":2.52},{"source":"Bioprocess technology","target":"Personalized medicine","weight":2.52},{"source":"Neural interfaces","target":"Biotechnologies","weight":2.51},{"source":"Biotechnologies","target":"Neural interfaces","weight":2.51},{"source":"Semiconductors & microchips","target":"Nanotechnologies","weight":2.48},{"source":"Personalized nutrition","target":"Personalized medicine","weight":2.43},{"source":"Semiconductors & microchips","target":"Quantum technologies","weight":2.34},{"source":"Industrial robotics","target":"Individual mass production","weight":2.32},{"source":"Individual mass production","target":"Industrial robotics","weight":2.32},{"source":"Ubiquitous computing","target":"Medical technology","weight":2.32},{"source":"Ubiquitous computing","target":"Smart factories","weight":2.32},{"source":"Medical technology","target":"Ubiquitous computing","weight":2.32},{"source":"Smart factories","target":"Ubiquitous computing","weight":2.32},{"source":"Biotechnologies","target":"AI & Big Data","weight":2.3},{"source":"AI & Big Data","target":"Biotechnologies","weight":2.3},{"source":"Semiconductors & microchips","target":"AI & Big Data","weight":2.22},{"source":"Nanotechnologies","target":"Biotechnologies","weight":2.21},{"source":"Biotechnologies","target":"Nanotechnologies","weight":2.21},{"source":"Smart farming","target":"Smart factories","weight":2.07},{"source":"Smart factories","target":"Smart farming","weight":2.07},{"source":"Medical technology","target":"AI & Big Data","weight":2.03},{"source":"AI & Big Data","target":"Medical technology","weight":2.03},{"source":"Precision breeding","target":"Biotechnologies","weight":2},{"source":"Biotechnologies","target":"Precision breeding","weight":2},{"source":"Medical technology","target":"Automation & robotics","weight":1.99},{"source":"Automation & robotics","target":"Medical technology","weight":1.99},{"source":"UAS & drone defense","target":"Industrial robotics","weight":1.97},{"source":"Industrial robotics","target":"UAS & drone defense","weight":1.97},{"source":"Quantum technologies","target":"Nanotechnologies","weight":1.94},{"source":"Nanotechnologies","target":"Quantum technologies","weight":1.94},{"source":"Industrial robotics","target":"AI & Big Data","weight":1.87},{"source":"AI & Big Data","target":"Industrial robotics","weight":1.87},{"source":"Maritime technology","target":"Automation & robotics","weight":1.86},{"source":"Water purification","target":"Nuclear fusion","weight":1.84},{"source":"UAS & drone defense","target":"Maritime technology","weight":1.83},{"source":"Maritime technology","target":"UAS & drone defense","weight":1.83},{"source":"Weapon systems & ammunition","target":"Maritime technology","weight":1.8},{"source":"Maritime technology","target":"Weapon systems & ammunition","weight":1.8},{"source":"Personalized medicine","target":"Automation & robotics","weight":1.7},{"source":"Automation & robotics","target":"Personalized medicine","weight":1.7},{"source":"Maritime technology","target":"Autonomous & connected mobility","weight":1.69},{"source":"Private air transport","target":"Autonomous & connected mobility","weight":1.69},{"source":"Autonomous & connected mobility","target":"Maritime technology","weight":1.69},{"source":"Autonomous & connected mobility","target":"Private air transport","weight":1.69},{"source":"UAS & drone defense","target":"Smart factories","weight":1.67},{"source":"Smart factories","target":"UAS & drone defense","weight":1.67},{"source":"UAS & drone defense","target":"AI & Big Data","weight":1.66},{"source":"AI & Big Data","target":"UAS & drone defense","weight":1.66},{"source":"Smart factories","target":"Autonomous & connected mobility","weight":1.58},{"source":"Autonomous & connected mobility","target":"Smart factories","weight":1.58},{"source":"Neural interfaces","target":"Data sciences & digital health","weight":1.57},{"source":"Data sciences & digital health","target":"Neural interfaces","weight":1.57},{"source":"Individual mass production","target":"Automation & robotics","weight":1.56},{"source":"Automation & robotics","target":"Individual mass production","weight":1.56},{"source":"Weapon systems & ammunition","target":"Industrial robotics","weight":1.56},{"source":"Industrial robotics","target":"Weapon systems & ammunition","weight":1.56},{"source":"Personalized medicine","target":"Nanotechnologies","weight":1.55},{"source":"Nanotechnologies","target":"Personalized medicine","weight":1.55},{"source":"Data sciences & digital health","target":"Data ecosystems","weight":1.48},{"source":"Data ecosystems","target":"Data sciences & digital health","weight":1.48},{"source":"Individual mass production","target":"AI & Big Data","weight":1.45},{"source":"AI & Big Data","target":"Individual mass production","weight":1.45},{"source":"Ubiquitous computing","target":"AI & Big Data","weight":1.42},{"source":"AI & Big Data","target":"Ubiquitous computing","weight":1.42},{"source":"Overall defense strategy","target":"Cybersecurity","weight":1.39},{"source":"Personalized medicine","target":"Immersive technologies","weight":1.39},{"source":"Cybersecurity","target":"Overall defense strategy","weight":1.39},{"source":"Immersive technologies","target":"Personalized medicine","weight":1.39},{"source":"Immersive technologies","target":"Automation & robotics","weight":1.38},{"source":"Industrial robotics","target":"Autonomous & connected mobility","weight":1.38},{"source":"Automation & robotics","target":"Immersive technologies","weight":1.38},{"source":"Autonomous & connected mobility","target":"Industrial robotics","weight":1.38},{"source":"Ubiquitous computing","target":"Nuclear fusion","weight":1.34},{"source":"Overall defense strategy","target":"AI & Big Data","weight":1.33},{"source":"AI & Big Data","target":"Overall defense strategy","weight":1.33},{"source":"Smart farming","target":"Platform economy","weight":1.33},{"source":"Personalized nutrition","target":"Individual mass production","weight":1.32},{"source":"Individual mass production","target":"Personalized nutrition","weight":1.32},{"source":"UAS & drone defense","target":"Smart farming","weight":1.3},{"source":"Smart farming","target":"UAS & drone defense","weight":1.3},{"source":"Ubiquitous computing","target":"Data sciences & digital health","weight":1.28},{"source":"Data sciences & digital health","target":"Ubiquitous computing","weight":1.28},{"source":"Precision breeding","target":"Personalized medicine","weight":1.27},{"source":"Personalized medicine","target":"Precision breeding","weight":1.27},{"source":"Quantum technologies","target":"Cybersecurity","weight":1.26},{"source":"Cybersecurity","target":"Quantum technologies","weight":1.26},{"source":"Space logistics","target":"Quantum technologies","weight":1.25},{"source":"Smart factories","target":"Semiconductors & microchips","weight":1.25},{"source":"Semiconductors & microchips","target":"Smart factories","weight":1.25},{"source":"Quantum technologies","target":"Space logistics","weight":1.25},{"source":"Smart farming","target":"Bioprocess technology","weight":1.24},{"source":"Bioprocess technology","target":"Smart farming","weight":1.24},{"source":"Weapon systems & ammunition","target":"Automation & robotics","weight":1.23},{"source":"Data ecosystems","target":"Cyber defense & infrastructure","weight":1.23},{"source":"Cyber defense & infrastructure","target":"Data ecosystems","weight":1.23},{"source":"Automation & robotics","target":"Weapon systems & ammunition","weight":1.23},{"source":"Platform economy","target":"Personalized medicine","weight":1.21},{"source":"Personalized medicine","target":"Platform economy","weight":1.21},{"source":"Cyber defense & infrastructure","target":"AI & Big Data","weight":1.19},{"source":"AI & Big Data","target":"Cyber defense & infrastructure","weight":1.19},{"source":"Smart factories","target":"Nuclear fusion","weight":1.19},{"source":"Nuclear fusion","target":"Smart factories","weight":1.19},{"source":"Semiconductors & microchips","target":"Autonomous & connected mobility","weight":1.17},{"source":"Autonomous & connected mobility","target":"Semiconductors & microchips","weight":1.17},{"source":"Weapon systems & ammunition","target":"Private air transport","weight":1.16},{"source":"Private air transport","target":"Weapon systems & ammunition","weight":1.16},{"source":"Neural interfaces","target":"AI & Big Data","weight":1.13},{"source":"Biotechnologies","target":"Biophotonics","weight":0.79},{"source":"Biophotonics","target":"Biotechnologies","weight":0.79},{"source":"Smart factories","target":"CCS / CCU","weight":0.59},{"source":"Mobility services","target":"CO2-neutral production","weight":0.46},{"source":"CO2-neutral production","target":"Biotechnologies","weight":0.43},{"source":"Biotechnologies","target":"CO2-neutral production","weight":0.43},{"source":"Nanotechnologies","target":"Geothermal energy","weight":0.5},{"source":"Geothermal energy","target":"Biotechnologies","weight":0.45},{"source":"Biotechnologies","target":"Geothermal energy","weight":0.45},{"source":"Private air transport","target":"Mobility services","weight":0.93},{"source":"Mobility services","target":"AI & Big Data","weight":0.65},{"source":"AI & Big Data","target":"Mobility services","weight":0.65},{"source":"Smart factories","target":"More flexible energy systems","weight":0.27},{"source":"More flexible energy systems","target":"Smart factories","weight":0.27},{"source":"Water purification","target":"Optics & photonics","weight":0.97},{"source":"Optics & photonics","target":"Water purification","weight":0.97}]  ;

      var width = window.innerWidth;
      var height = window.innerHeight;
      var nodeRadius = 48;
      var HOR_PADDING = nodeRadius * 6;
      var padding = nodeRadius * 2;

      var extentX = d3.extent(nodes, function(d) { return d.x; });
      var extentY = d3.extent(nodes, function(d) { return d.y; });

      var availableWidth = Math.max(width - padding * 2, padding);
      var availableHeight = Math.max(height - padding * 2, padding);

      var baseLeft = padding;
      var baseRight = padding + availableWidth;

      var minXBound = baseLeft + HOR_PADDING + nodeRadius;
      var maxXBound = baseRight - HOR_PADDING - nodeRadius;

      if (maxXBound <= minXBound) {
        var midpoint = (baseLeft + baseRight) / 2;
        minXBound = midpoint - 1;
        maxXBound = midpoint + 1;
      }

      var horizontalBounds = {
        min: minXBound,
        max: maxXBound
      };

      var scaleX = d3.scaleLinear()
        .domain(extentX)
        .range([horizontalBounds.min, horizontalBounds.max]);

      var scaleY = d3.scaleLinear()
        .domain(extentY)
        .range([padding, padding + availableHeight]);

      function clampX(value) {
        return Math.max(horizontalBounds.min, Math.min(horizontalBounds.max, value));
      }

      nodes.forEach(function(node) {
        var targetX = clampX(scaleX(node.x));
        var targetY = scaleY(node.y);
        node.originalX = targetX;
        node.originalY = targetY;
        node.x = targetX;
        node.y = targetY;
      });

      var svg = d3.select("svg.network")
        .attr("viewBox", [0, 0, width, height])
        .attr("preserveAspectRatio", "xMidYMid meet");

      var container = svg.append("g");

      var zoomBehavior = d3.zoom()
        .scaleExtent([0.6, 3])
        .on("zoom", function(event) {
          container.attr("transform", event.transform);
        });

      svg.call(zoomBehavior);

      var nodeById = new Map(nodes.map(function(node) {
        return [node.id, node];
      }));

      var linkData = links.map(function(link) {
        return {
          source: nodeById.get(link.source),
          target: nodeById.get(link.target),
          weight: link.weight
        };
      }).filter(function(link) {
        return link.source && link.target;
      });

      var linkExtent = linkData.length ? d3.extent(linkData, function(d) { return d.weight || 1; }) : [1, 1];
      if (linkExtent[0] === linkExtent[1]) {
        linkExtent[1] = linkExtent[0] + 1;
      }

      var linkWidth = d3.scaleSqrt()
        .domain(linkExtent)
        .range([0.6, 4]);

      var link = container.append("g")
        .attr("stroke-linecap", "round")
        .selectAll("line")
        .data(linkData)
        .join("line")
        .attr("class", "link")
        .attr("stroke-width", function(d) { return linkWidth(d.weight || 1); });

      var adjacency = new Map();

      linkData.forEach(function(link) {
        var sourceId = link.source.id;
        var targetId = link.target.id;

        if (!adjacency.has(sourceId)) {
          adjacency.set(sourceId, new Set());
        }

        if (!adjacency.has(targetId)) {
          adjacency.set(targetId, new Set());
        }

        adjacency.get(sourceId).add(targetId);
        adjacency.get(targetId).add(sourceId);
      });

      var node = container.append("g")
        .selectAll("g")
        .data(nodes)
        .join("g")
        .attr("class", "node")
        .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended))
        .on("mouseenter", highlightConnected)
        .on("mouseleave", resetHighlight);

      node.append("circle")
        .attr("r", nodeRadius)
        .attr("fill", function(d) { return d.color; });

      node.append("text")
        .attr("class", "node-label")
        .attr("fill", function(d) {
          return isColorDark(d.color) ? "#ffffff" : "#1b1d21";
        })
        .call(wrapText, nodeRadius * 1.8);

      node.append("title")
        .text(function(d) {
          return d.id + (d.parent ? " (" + d.parent + ")" : "");
        });

      var simulation = d3.forceSimulation(nodes)
        .alpha(0.9)
        .alphaDecay(0.09)
        .force("collide", d3.forceCollide(nodeRadius + 8).strength(0.95).iterations(4))
        .force("x", d3.forceX(function(d) { return d.originalX; }).strength(1))
        .force("y", d3.forceY(function(d) { return d.originalY; }).strength(1))
        .on("tick", ticked);

      function ticked() {
        nodes.forEach(function(d) {
          d.x = clampX(d.x);
          if (d.fx != null) {
            d.fx = clampX(d.fx);
          }
        });

        link
          .attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });

        node.attr("transform", function(d) {
          return "translate(" + d.x + "," + d.y + ")";
        });
      }

      function dragstarted(event, d) {
        if (!event.active) {
          simulation.alphaTarget(0.3).restart();
        }
        d.fx = clampX(d.x);
        d.fy = d.y;
      }

      function dragged(event, d) {
        var clampedX = clampX(event.x);
        d.fx = clampedX;
        d.fy = event.y;
        d.x = clampedX;
        d.y = event.y;
      }

      function dragended(event, d) {
        if (!event.active) {
          simulation.alphaTarget(0);
        }
        d.fx = null;
        d.fy = null;
      }

      function highlightConnected(event, nodeDatum) {
        var neighbors = adjacency.get(nodeDatum.id) || new Set();
        var activeIds = new Set(neighbors);
        activeIds.add(nodeDatum.id);

        node.each(function(d) {
          var isActive = activeIds.has(d.id);
          d3.select(this)
            .classed("highlighted", isActive)
            .classed("dimmed", !isActive);
        });

        link.each(function(l) {
          var isActive = l.source.id === nodeDatum.id || l.target.id === nodeDatum.id;
          d3.select(this)
            .classed("highlighted", isActive)
            .classed("dimmed", !isActive);
        });
      }

      function resetHighlight() {
        node.classed("highlighted", false)
          .classed("dimmed", false);
        link.classed("highlighted", false)
          .classed("dimmed", false);
      }

      function isColorDark(hexColor) {
        if (!hexColor) {
          return false;
        }

        var hex = hexColor.trim().replace("#", "");
        if (hex.length === 3) {
          hex = hex.split("").map(function(ch) { return ch + ch; }).join("");
        }

        if (hex.length !== 6) {
          return false;
        }

        var r = parseInt(hex.slice(0, 2), 16) / 255;
        var g = parseInt(hex.slice(2, 4), 16) / 255;
        var b = parseInt(hex.slice(4, 6), 16) / 255;

        var convert = function(channel) {
          return channel <= 0.03928 ? channel / 12.92 : Math.pow((channel + 0.055) / 1.055, 2.4);
        };

        var lum = 0.2126 * convert(r) + 0.7152 * convert(g) + 0.0722 * convert(b);
        return lum < 0.55;
      }

      function wrapText(selection, maxWidth) {
        var lineHeight = 14;

        selection.each(function(d) {
          var text = d3.select(this);
          var label = d.id || "";
          var words = label.split(/\s+/).filter(function(word) { return word.length; });
          text.selectAll("tspan").remove();
          text.text("");

          if (!words.length) {
            text.append("tspan")
              .attr("x", 0)
              .attr("y", 0)
              .text(label);
            return;
          }

          var lines = [];
          var currentLine = [];

          words.forEach(function(word) {
            var testLine = currentLine.concat(word);
            var tester = text.append("tspan").text(testLine.join(" "));
            var lineLength = tester.node().getComputedTextLength();
            tester.remove();

            if (lineLength <= maxWidth || currentLine.length === 0) {
              currentLine.push(word);
            } else {
              lines.push(currentLine.join(" "));
              currentLine = [word];
            }
          });

          if (currentLine.length) {
            lines.push(currentLine.join(" "));
          }

          var offset = (lines.length - 1) * lineHeight / 2;

          lines.forEach(function(line, index) {
            text.append("tspan")
              .attr("x", 0)
              .attr("y", -offset + index * lineHeight)
              .text(line);
          });
        });
      }

      var zoomButtons = d3.selectAll(".zoom-controls button");

      zoomButtons.on("click", function(event) {
        var type = d3.select(this).attr("data-zoom");
        if (type === "in") {
          svg.transition().duration(200).call(zoomBehavior.scaleBy, 1.2);
        } else if (type === "out") {
          svg.transition().duration(200).call(zoomBehavior.scaleBy, 0.8);
        } else {
          svg.transition().duration(300).call(zoomBehavior.transform, d3.zoomIdentity);
        }
      });

    </script>

  </body>

</html>
